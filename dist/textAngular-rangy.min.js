!function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){var o="object",r="function",n="undefined",c=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],d=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],k=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],H=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function f(e,t){var n=typeof e[t];return n==r||!(n!=o||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=o||!e[t])}function e(e,t){return typeof e[t]!=n}function i(o){return function(e,t){for(var n=t.length;n--;)if(!o(e,t[n]))return!1;return!0}}var u=i(f),a=i(t),l=i(e);function h(e){return e&&u(e,H)&&l(e,k)}function g(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}var s,p,m,R={},v=typeof window!=n&&typeof document!=n,C={isHostMethod:f,isHostObject:t,isHostProperty:e,areHostMethods:u,areHostObjects:a,areHostProperties:l,isTextRange:h,getBody:g,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,o=e.length;n<o;++n)t(e[n],n)}},N={version:"1.3.0",initialized:!1,isBrowser:v,supported:!0,util:C,features:{},modules:R,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==n||rangyAutoInitialize}};function E(e){typeof console!=n&&f(console,"log")&&console.log(e)}function S(e,t){(v&&t?alert:E)(e)}function y(e){N.initialized=!0,N.supported=!1,S("Rangy is not supported in this environment. Reason: "+e,N.config.alertOnFail)}if(N.fail=y,N.warn=function(e){S("Rangy warning: "+e,N.config.alertOnWarn)},!{}.hasOwnProperty?y("hasOwnProperty not supported"):(C.extend=s=function(e,t,n){var o,r,i;for(i in t)t.hasOwnProperty(i)&&(o=e[i],r=t[i],n&&null!==o&&"object"==typeof o&&null!==r&&"object"==typeof r&&s(o,r,!0),e[i]=r);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},C.createOptions=function(e,t){var n={};return s(n,t),e&&s(n,e),n}),v||y("Rangy can only run in a browser"),v){var a=document.createElement("div"),w=(a.appendChild(document.createElement("span")),[].slice);try{1==w.call(a.childNodes,0)[0].nodeType&&(p=function(e){return w.call(e,0)})}catch(e){}}C.toArray=p=p||function(e){for(var t=[],n=0,o=e.length;n<o;++n)t[n]=e[n];return t},v&&(f(document,"addEventListener")?m=function(e,t,n){e.addEventListener(t,n,!1)}:f(document,"attachEvent")?m=function(e,t,n){e.attachEvent("on"+t,n)}:y("Document does not have required addEventListener or attachEvent method"),C.addListener=m);var T=[];function O(e){return e.message||e.description||String(e)}function _(){if(v&&!N.initialized){var e,t,n,o=!1,r=!1,i=(f(document,"createRange")&&(e=document.createRange(),u(e,d)&&l(e,c)&&(o=!0)),g(document));if(i&&"body"==i.nodeName.toLowerCase())if(i&&f(i,"createTextRange")&&h(e=i.createTextRange())&&(r=!0),o||r){for(n in N.initialized=!0,N.features={implementsDomRange:o,implementsTextRange:r},R)(t=R[n])instanceof I&&t.init(t,N);for(var a=0,s=T.length;a<s;++a)try{T[a](N)}catch(e){E("Rangy init listener threw an exception. Continuing. Detail: "+O(e))}}else y("Neither Range nor TextRange are available");else y("No body element found")}}function D(e,t,n){n&&(e+=" in module "+n.name),N.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function A(e,t,n,o){e[t]=function(){return D(t,n,o),e[n].apply(e,C.toArray(arguments))}}C.deprecationNotice=D,C.createAliasForDeprecatedMethod=A,N.init=_,N.addInitListener=function(e){N.initialized?e(N):T.push(e)};var x=[];function I(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function b(t,e,n){e=new I(t,e,function(e){if(!e.initialized){e.initialized=!0;try{n(N,e),e.supported=!0}catch(e){E("Module '"+t+"' failed to load: "+O(e)),e.stack&&E(e.stack)}}});return R[t]=e}function P(){}N.addShimListener=function(e){x.push(e)},v&&(N.shim=N.createMissingNativeApi=function(e){e=e||window,_();for(var t=0,n=x.length;t<n;++t)x[t](e)},A(N,"createMissingNativeApi","shim")),I.prototype={init:function(){for(var e,t,n=this.dependencies||[],o=0,r=n.length;o<r;++o){if(t=n[o],!((e=R[t])&&e instanceof I))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){N.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){N.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},N.createModule=function(e){var t,n=2==arguments.length?(t=arguments[1],[]):(t=arguments[2],arguments[1]),n=b(e,n,t);N.initialized&&N.supported&&n.init()},N.createCoreModule=function(e,t,n){b(e,t,n)},N.RangePrototype=P,N.rangePrototype=new P,N.selectionPrototype=new function(){},N.createCoreModule("DomUtil",[],function(e,c){function r(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1}var t="undefined",i=e.util,a=i.getBody,n=(i.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||c.fail("document missing a Node creation method"),i.isHostMethod(document,"getElementsByTagName")||c.fail("document missing getElementsByTagName method"),document.createElement("div")),n=(i.areHostMethods(n,["insertBefore","appendChild","cloneNode"])||c.fail("Incomplete Element implementation"),i.isHostProperty(n,"innerHTML")||c.fail("Element is missing innerHTML property"),document.createTextNode("test"));i.areHostMethods(n,["splitText","deleteData","insertData","appendData","cloneNode"])||c.fail("Incomplete Text Node implementation");function d(e){for(var t=0;e=e.previousSibling;)++t;return t}function f(e,t){for(var n=[],o=e;o;o=o.parentNode)n.push(o);for(o=t;o;o=o.parentNode)if(r(n,o))return o;return null}function o(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function u(e,t,n){for(var o,r=n?e:e.parentNode;r;){if((o=r.parentNode)===t)return r;r=o}return null}function s(e){e=e.nodeType;return 3==e||4==e||8==e}function l(e,t){var n=t.nextSibling,t=t.parentNode;return n?t.insertBefore(e,n):t.appendChild(e),e}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=t)return e.ownerDocument;if(typeof e.document!=t)return e.document;if(e.parentNode)return h(e.parentNode);throw c.createError("getDocument: no document found for node")}function g(e){e=h(e);if(typeof e.defaultView!=t)return e.defaultView;if(typeof e.parentWindow!=t)return e.parentWindow;throw c.createError("Cannot get a window object for node")}function p(e){if(typeof e.contentDocument!=t)return e.contentDocument;if(typeof e.contentWindow!=t)return e.contentWindow.document;throw c.createError("getIframeDocument: No Document object found for iframe element")}function m(e){return e&&i.isHostMethod(e,"setTimeout")&&i.isHostObject(e,"document")}var R,v,C;function N(e){try{return e.parentNode,!1}catch(e){return!0}}function E(e){return e?R&&N(e)?"[Broken node]":s(e)?'"'+e.data+'"':1==e.nodeType?(t=e.id?' id="'+e.id+'"':"","<"+e.nodeName+t+">[index:"+d(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"):e.nodeName:"[No node]";var t}function S(e){this.root=e,this._next=e}function y(e,t){this.node=e,this.offset=t}function w(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}(n=document.createElement("b")).innerHTML="1",v=n.firstChild,n.innerHTML="<br />",R=N(v),e.features.crashyTextNodes=R,typeof window.getComputedStyle!=t?C=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=t?C=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:c.fail("No means of obtaining computed style properties found"),S.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},y.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+E(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},(w.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24}).toString=function(){return this.message},e.dom={arrayContains:r,isHtmlNamespace:function(e){return typeof e.namespaceURI==t||null===(e=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==e},parentElement:function(e){return 1==(e=e.parentNode).nodeType?e:null},getNodeIndex:d,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:f,isAncestorOf:o,isOrIsAncestorOf:function(e,t){return o(e,t,!0)},getClosestAncestorIn:u,isCharacterDataNode:s,isTextOrCommentNode:function(e){return!!e&&(3==(e=e.nodeType)||8==e)},insertAfter:l,splitDataNode:function(e,t,n){var o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),l(o,e),n)for(var r,i=0;r=n[i++];)r.node==e&&r.offset>t?(r.node=o,r.offset-=t):r.node==e.parentNode&&r.offset>d(e)&&++r.offset;return o},getDocument:h,getWindow:g,getIframeWindow:function(e){if(typeof e.contentWindow!=t)return e.contentWindow;if(typeof e.contentDocument!=t)return e.contentDocument.defaultView;throw c.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:p,getBody:a,isWindow:m,getContentDocument:function(e,t,n){var o;if(e?i.isHostProperty(e,"nodeType")?o=(1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?p:h)(e):m(e)&&(o=e.document):o=document,o)return o;throw t.createError(n+"(): Parameter must be a Window object or DOM node")},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,t,n,o){var r,i,a,s;if(e==n)return t===o?0:t<o?-1:1;if(r=u(n,e,!0))return t<=d(r)?-1:1;if(r=u(e,n,!0))return d(r)<o?-1:1;if(!(t=f(e,n)))throw new Error("comparePoints error: nodes have no common ancestor");if((i=e===t?t:u(e,t,!0))===(a=n===t?t:u(n,t,!0)))throw c.createError("comparePoints got to case 4 and childA and childB are the same!");for(s=t.firstChild;s;){if(s===i)return-1;if(s===a)return 1;s=s.nextSibling}},isBrokenNode:N,inspectNode:E,getComputedStyleProperty:C,createTestElement:function(e,t,n){var o=a(e);return(e=e.createElement("div")).contentEditable=""+!!n,t&&(e.innerHTML=t),(n=o.firstChild)?o.insertBefore(e,n):o.appendChild(e),e},removeNode:function(e){return e.parentNode.removeChild(e)},fragmentFromNodeChildren:function(e){for(var t,n=h(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new S(e)},DomPosition:y},e.DOMException=w}),N.createCoreModule("DomRange",["DomUtil"],function(i,k){var s=i.dom,a=i.util,t=s.DomPosition,c=i.DOMException,f=s.isCharacterDataNode,u=s.getNodeIndex,d=s.isOrIsAncestorOf,r=s.getDocument,l=s.comparePoints,h=s.splitDataNode,g=s.getClosestAncestorIn,p=s.getNodeLength,m=s.arrayContains,R=s.getRootContainer,H=i.features.crashyTextNodes,v=s.removeNode;function C(e,t){return 3!=e.nodeType&&(d(e,t.startContainer)||d(e,t.endContainer))}function N(e){return e.document||r(e.startContainer)}function E(e){return new t(e.parentNode,u(e))}function S(e){return new t(e.parentNode,u(e)+1)}function n(e,t,n){var o=11==e.nodeType?e.firstChild:e;return f(t)?n==t.length?s.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:h(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function o(e,t,n){if(x(e),x(t),N(t)!=N(e))throw new c("WRONG_DOCUMENT_ERR");var o=l(e.startContainer,e.startOffset,t.endContainer,t.endOffset),e=l(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?o<=0&&0<=e:o<0&&0<e}function y(e,t,n){var o,r,i,a;for(n=n||{stop:!1};i=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(i))return void(n.stop=!0);if(y(a=e.getSubtreeIterator(),t,n),a.detach(),n.stop)return}else for(o=s.createIterator(i);r=o.next();)if(!1===t(r))return void(n.stop=!0)}function L(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(L(t=e.getSubtreeIterator()),t.detach()):e.remove()}function W(e){for(var t,n,o=N(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(W(n)),n.detach()):e.remove(),10==t.nodeType)throw new c("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function F(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+s.inspectNode(e.startContainer)+":"+e.startOffset+", "+s.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function w(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t,e.collapsed||(this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset,t=e.commonAncestorContainer,this.sc===this.ec&&f(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==t||f(this.sc)?g(this.sc,t,!0):this.sc.childNodes[this.so],this._last=this.ec!==t||f(this.ec)?g(this.ec,t,!0):this.ec.childNodes[this.eo-1]))}w.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,f(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!f(n)||n!==this.sc&&n!==this.ec?n.parentNode&&v(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return C(this._current,this.range)},getSubtreeIterator:function(){var e,t,n,o,r,i;return this.isSingleCharacterDataNode?(e=this.range.cloneRange()).collapse(!1):(e=new M(N(this.range)),t=this._current,o=0,i=p(r=n=t),d(t,this.sc)&&(n=this.sc,o=this.so),d(t,this.ec)&&(r=this.ec,i=this.eo),ue(e,n,o,r,i)),new w(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var z=[1,3,4,5,7,8,10],j=[2,9,11],V=[1,3,4,5,7,8,10,11],U=[1,3,4,5,7,8];function e(r){return function(e,t){for(var n,o=t?e:e.parentNode;o;){if(n=o.nodeType,m(r,n))return o;o=o.parentNode}return null}}var q=e([9,11]),Y=e([5,6,10,12]),Q=e([6,10,12]);function T(e,t){if(Q(e,t))throw new c("INVALID_NODE_TYPE_ERR")}function O(e,t){if(!m(t,e.nodeType))throw new c("INVALID_NODE_TYPE_ERR")}function _(e,t){if(t<0||t>(f(e)?e:e.childNodes).length)throw new c("INDEX_SIZE_ERR")}function D(e,t){if(q(e,!0)!==q(t,!0))throw new c("WRONG_DOCUMENT_ERR")}function A(e){if(Y(e,!0))throw new c("NO_MODIFICATION_ALLOWED_ERR")}function G(e,t){if(!e)throw new c(t)}function X(e,t){return t<=(f(e)?e:e.childNodes).length}function Z(e){return!!e.startContainer&&!!e.endContainer&&!(H&&(s.isBrokenNode(e.startContainer)||s.isBrokenNode(e.endContainer)))&&R(e.startContainer)==R(e.endContainer)&&X(e.startContainer,e.startOffset)&&X(e.endContainer,e.endOffset)}function x(e){if(!Z(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var $=document.createElement("style"),I=!1;try{$.innerHTML="<b>x</b>",I=3==$.firstChild.nodeType}catch(e){}function J(e,t){x(e);var n=e.startContainer,o=e.startOffset,r=e.endContainer,i=e.endOffset,a=n===r;f(r)&&0<i&&i<r.length&&h(r,i,t),f(n)&&0<o&&o<n.length&&(n=h(n,o,t),a?(i-=o,r=n):r==n.parentNode&&i>=u(n)&&i++,o=0),e.setStartAndEnd(n,o,r,i)}function K(e){x(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}i.features.htmlParsingConforms=I;var b=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],P=0,ee=1,te=2,ne=3,oe=0,re=1,ie=2,B=3;function ae(e){e.START_TO_START=P,e.START_TO_END=ee,e.END_TO_END=te,e.END_TO_START=ne,e.NODE_BEFORE=oe,e.NODE_AFTER=re,e.NODE_BEFORE_AND_AFTER=ie,e.NODE_INSIDE=B}function se(e){ae(e),ae(e.prototype)}function ce(r,i){return function(){x(this);var e=this.startContainer,t=this.startOffset,n=this.commonAncestorContainer,o=new w(this,!0),n=(e!==n&&(e=(n=S(g(e,n,!0))).node,t=n.offset),y(o,A),o.reset(),r(o));return o.detach(),i(this,e,t,e,t),n}}function de(e,d){function t(t,n){return function(e){O(e,z),O(R(e),j);e=(t?E:S)(e);(n?o:r)(this,e.node,e.offset)}}function o(e,t,n){var o=e.endContainer,r=e.endOffset;t===e.startContainer&&n===e.startOffset||(R(t)==R(o)&&1!=l(t,n,o,r)||(o=t,r=n),d(e,t,n,o,r))}function r(e,t,n){var o=e.startContainer,r=e.startOffset;t===e.endContainer&&n===e.endOffset||(R(t)==R(o)&&-1!=l(t,n,o,r)||(o=t,r=n),d(e,o,r,t,n))}function n(){}n.prototype=i.rangePrototype,e.prototype=new n,a.extend(e.prototype,{setStart:function(e,t){T(e,!0),_(e,t),o(this,e,t)},setEnd:function(e,t){T(e,!0),_(e,t),r(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,r=n;switch(e.length){case 3:r=e[2];break;case 4:o=e[2],r=e[3]}d(this,t,n,o,r)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:t(!0,!0),setStartAfter:t(!1,!0),setEndBefore:t(!0,!1),setEndAfter:t(!1,!1),collapse:function(e){x(this),e?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){T(e,!0),d(this,e,0,e,p(e))},selectNode:function(e){T(e,!1),O(e,z);var t=E(e),e=S(e);d(this,t.node,t.offset,e.node,e.offset)},extractContents:ce(W,d),deleteContents:ce(L,d),canSurroundContents:function(){x(this),A(this.startContainer),A(this.endContainer);var e=new w(this,!0),t=e._first&&C(e._first,this)||e._last&&C(e._last,this);return e.detach(),!t},splitBoundaries:function(){J(this)},splitBoundariesPreservingPositions:function(e){J(this,e)},normalizeBoundaries:function(){x(this);function e(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(s=(a=e).length,e.appendData(t.data),v(t))}function t(e){var t,n=e.previousSibling;n&&n.nodeType==e.nodeType&&(t=(r=e).length,i=n.length,e.insertData(0,n.data),v(n),r==a?(s+=i,a=r):a==e.parentNode&&(n=u(e),s==n?(a=e,s=t):n<s&&s--))}var n,o,r=this.startContainer,i=this.startOffset,a=this.endContainer,s=this.endOffset,c=!0;f(a)?s==a.length?e(a):0==s&&(n=a.previousSibling)&&n.nodeType==a.nodeType&&(s=n.length,r==a&&(c=!1),n.appendData(a.data),v(a),a=n):(0<s&&((o=a.childNodes[s-1])&&f(o)&&e(o)),c=!this.collapsed),c?f(r)?0==i?t(r):i==r.length&&(n=r.nextSibling)&&n.nodeType==r.nodeType&&(a==n&&(s+=(a=r).length),r.appendData(n.data),v(n)):i<r.childNodes.length&&((o=r.childNodes[i])&&f(o)&&t(o)):(r=a,i=s),d(this,r,i,a,s)},collapseToPoint:function(e,t){T(e,!0),_(e,t),this.setStartAndEnd(e,t)}}),se(e)}function fe(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:s.getCommonAncestor(e.startContainer,e.endContainer)}function ue(e,t,n,o,r){e.startContainer=t,e.startOffset=n,e.endContainer=o,e.endOffset=r,e.document=s.getDocument(t),fe(e)}function M(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,fe(this)}a.extend(i.rangePrototype,{compareBoundaryPoints:function(e,t){x(this),D(this.startContainer,t.startContainer);var n=e==ne||e==P?"start":"end",e=e==ee||e==P?"start":"end",o=this[n+"Container"],n=this[n+"Offset"],r=t[e+"Container"],t=t[e+"Offset"];return l(o,n,r,t)},insertNode:function(e){if(x(this),O(e,V),A(this.startContainer),d(e,this.startContainer))throw new c("HIERARCHY_REQUEST_ERR");e=n(e,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){if(x(this),this.collapsed)return N(this).createDocumentFragment();if(this.startContainer===this.endContainer&&f(this.startContainer))return(t=this.startContainer.cloneNode(!0)).data=t.data.slice(this.startOffset,this.endOffset),(e=N(this).createDocumentFragment()).appendChild(t),e;var e=new w(this,!0),t=function e(t){for(var n,o,r=N(t.range).createDocumentFragment();n=t.next();){if(o=t.isPartiallySelectedSubtree(),n=n.cloneNode(!o),o&&(o=t.getSubtreeIterator(),n.appendChild(e(o)),o.detach()),10==n.nodeType)throw new c("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}(e);return e.detach(),t},canSurroundContents:function(){x(this),A(this.startContainer),A(this.endContainer);var e=new w(this,!0),t=e._first&&C(e._first,this)||e._last&&C(e._last,this);return e.detach(),!t},surroundContents:function(e){if(O(e,U),!this.canSurroundContents())throw new c("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);n(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){x(this);for(var e,t=new M(N(this)),n=b.length;n--;)t[e=b[n]]=this[e];return t},toString:function(){x(this);var t,e=this.startContainer;return e===this.endContainer&&f(e)?3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"":(t=[],y(e=new w(this,!0),function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),e.detach(),t.join(""))},compareNode:function(e){x(this);var t=e.parentNode,e=u(e);if(!t)throw new c("NOT_FOUND_ERR");var n=this.comparePoint(t,e),t=this.comparePoint(t,e+1);return n<0?0<t?ie:oe:0<t?re:B},comparePoint:function(e,t){return x(this),G(e,"HIERARCHY_REQUEST_ERR"),D(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)<0?-1:0<l(e,t,this.endContainer,this.endOffset)?1:0},createContextualFragment:I?function(e){var t=this.startContainer,n=r(t);if(!t)throw new c("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:f(t)&&(o=s.parentElement(t)),(o=null===o||"HTML"==o.nodeName&&s.isHtmlNamespace(r(o).documentElement)&&s.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1)).innerHTML=e,s.fragmentFromNodeChildren(o)}:function(e){var t=N(this).createElement("body");return t.innerHTML=e,s.fragmentFromNodeChildren(t)},toHtml:function(){return K(this)},intersectsNode:function(e,t){if(x(this),R(e)!=R(this.startContainer))return!1;var n=e.parentNode,e=u(e);if(!n)return!0;var o=l(n,e,this.endContainer,this.endOffset),n=l(n,e+1,this.startContainer,this.startOffset);return t?o<=0&&0<=n:o<0&&0<n},isPointInRange:function(e,t){return x(this),G(e,"HIERARCHY_REQUEST_ERR"),D(e,this.startContainer),0<=l(e,t,this.startContainer,this.startOffset)&&l(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return o(this,e,!1)},intersectsOrTouchesRange:function(e){return o(this,e,!0)},intersection:function(e){var t,n,o;return this.intersectsRange(e)?(t=l(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=l(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange(),-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o):null},union:function(e){var t;if(this.intersectsOrTouchesRange(e))return t=this.cloneRange(),-1==l(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==l(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t;throw new c("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==B},containsNodeContents:function(e){return 0<=this.comparePoint(e,0)&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange(),n=(t.selectNode(e),t.getNodes([3]));return 0<n.length?(t.setStart(n[0],0),n=n.pop(),t.setEnd(n,n.length),this.containsRange(t)):this.containsNodeContents(e)},getNodes:function(e,t){return x(this),n=this,o=t,i=!(!(t=e)||!t.length),a=!!o,i&&(r=new RegExp("^("+t.join("|")+")$")),y(new w(n,!(s=[])),function(e){var t;i&&!r.test(e.nodeType)||a&&!o(e)||(e==(t=n.startContainer)&&f(t)&&n.startOffset==t.length||(e==(t=n.endContainer)&&f(t)&&0==n.endOffset||s.push(e)))}),s;var n,o,r,i,a,s},getDocument:function(){return N(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(e){var t=N(this),n=i.createRange(t),t=(e=e||s.getBody(t),n.selectNodeContents(e),this.intersection(n)),o=0,r=0;return t&&(n.setEnd(t.startContainer,t.startOffset),r=(o=n.toString().length)+t.toString().length),{start:o,end:r,containerNode:e}},moveToBookmark:function(e){for(var t,n,o,r,i=e.containerNode,a=0,s=(this.setStart(i,0),this.collapse(!0),[i]),c=!1,d=!1;!d&&(t=s.pop());)if(3==t.nodeType)n=a+t.length,!c&&e.start>=a&&e.start<=n&&(this.setStart(t,e.start-a),c=!0),c&&e.end>=a&&e.end<=n&&(this.setEnd(t,e.end-a),d=!0),a=n;else for(o=(r=t.childNodes).length;o--;)s.push(r[o])},getName:function(){return"DomRange"},equals:function(e){return M.rangesEqual(this,e)},isValid:function(){return Z(this)},inspect:function(){return F(this)},detach:function(){}}),de(M,ue),a.extend(M,{rangeProperties:b,RangeIterator:w,copyComparisonConstants:se,createPrototypeRange:de,inspect:F,toHtml:K,getRangeDocument:N,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),i.DomRange=M}),N.createCoreModule("WrappedRange",["DomRange"],function(n,t){var e,i,o,r,R=n.dom,a=n.util,v=R.DomPosition,s=n.DomRange,c=R.getBody,d=R.getContentDocument,C=R.isCharacterDataNode;if(n.features.implementsDomRange){var f,u=s.rangeProperties;function l(e){for(var t,n=u.length;n--;)e[t=u[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}s.createPrototypeRange(e=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,l(this)},function(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==o||e.endOffset!=r,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(o,r),e.setStart(t,n))}),(f=e.prototype).selectNode=function(e){this.nativeRange.selectNode(e),l(this)},f.cloneContents=function(){return this.nativeRange.cloneContents()},f.surroundContents=function(e){this.nativeRange.surroundContents(e),l(this)},f.collapse=function(e){this.nativeRange.collapse(e),l(this)},f.cloneRange=function(){return new e(this.nativeRange.cloneRange())},f.refresh=function(){l(this)},f.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test"),g=(c(document).appendChild(h),document.createRange());g.setStart(h,0),g.setEnd(h,0);try{g.setStart(h,1),f.setStart=function(e,t){this.nativeRange.setStart(e,t),l(this)},f.setEnd=function(e,t){this.nativeRange.setEnd(e,t),l(this)},p=function(t){return function(e){this.nativeRange[t](e),l(this)}}}catch(e){f.setStart=function(t,n){try{this.nativeRange.setStart(t,n)}catch(e){this.nativeRange.setEnd(t,n),this.nativeRange.setStart(t,n)}l(this)},f.setEnd=function(t,n){try{this.nativeRange.setEnd(t,n)}catch(e){this.nativeRange.setStart(t,n),this.nativeRange.setEnd(t,n)}l(this)},p=function(n,o){return function(t){try{this.nativeRange[n](t)}catch(e){this.nativeRange[o](t),this.nativeRange[n](t)}l(this)}}}f.setStartBefore=p("setStartBefore","setEndBefore"),f.setStartAfter=p("setStartAfter","setEndAfter"),f.setEndBefore=p("setEndBefore","setStartBefore"),f.setEndAfter=p("setEndAfter","setStartAfter"),f.selectNodeContents=function(e){this.setStartAndEnd(e,0,R.getNodeLength(e))},g.selectNodeContents(h),g.setEnd(h,3);var p=document.createRange();p.selectNodeContents(h),p.setEnd(h,4),p.setStart(h,2),-1==g.compareBoundaryPoints(g.START_TO_END,p)&&1==g.compareBoundaryPoints(g.END_TO_START,p)?f.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:f.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};(p=document.createElement("div")).innerHTML="123";var m=p.firstChild,N=c(document);N.appendChild(p),g.setStart(m,1),g.setEnd(m,2),g.deleteContents(),"13"==m.data&&(f.deleteContents=function(){this.nativeRange.deleteContents(),l(this)},f.extractContents=function(){var e=this.nativeRange.extractContents();return l(this),e}),N.removeChild(p),N=null,a.isHostMethod(g,"createContextualFragment")&&(f.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(h),f.getName=function(){return"WrappedRange"},n.WrappedRange=e,n.createNativeRange=function(e){return(e=d(e,t,"createNativeRange")).createRange()}}n.features.implementsTextRange&&(i=function(e,t,n,o,r){var i=e.duplicate(),a=(i.collapse(n),i.parentElement());if(!(a=R.isOrIsAncestorOf(t,a)?a:t).canHaveHTML)return{boundaryPosition:t=new v(a.parentNode,R.getNodeIndex(a)),nodeInfo:{nodeIndex:t.offset,containerElement:t.node}};var s=R.getDocument(a).createElement("span");s.parentNode&&R.removeNode(s);for(var c,d,f=n?"StartToStart":"StartToEnd",u=r&&r.containerElement==a?r.nodeIndex:0,l=a.childNodes.length,h=l,g=h;g==l?a.appendChild(s):a.insertBefore(s,a.childNodes[g]),i.moveToElementText(s),0!=(c=i.compareEndPoints(f,e))&&u!=h;){if(-1==c){if(h==u+1)break;u=g}else h=h==u+1?u:g;g=Math.floor((u+h)/2),a.removeChild(s)}if(t=s.nextSibling,-1==c&&t&&C(t)){if(i.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(t.data))for(var p=i.duplicate(),r=p.text.replace(/\r\n/g,"\r").length,m=p.moveStart("character",r);-1==(c=p.compareEndPoints("StartToEnd",p));)m++,p.moveStart("character",1);else m=i.text.length;d=new v(t,m)}else r=(o||!n)&&s.previousSibling,d=(t=(o||n)&&s.nextSibling)&&C(t)?new v(t,0):r&&C(r)?new v(r,r.data.length):new v(a,R.getNodeIndex(s));return R.removeNode(s),{boundaryPosition:d,nodeInfo:{nodeIndex:g,containerElement:a}}},o=function(e,t){var n,o=e.offset,r=R.getDocument(e.node),i=c(r).createTextRange(),a=C(e.node),s=a?(n=e.node).parentNode:(n=o<(s=e.node.childNodes).length?s[o]:null,e.node),e=r.createElement("span");return e.innerHTML="&#feff;",n?s.insertBefore(e,n):s.appendChild(e),i.moveToElementText(e),i.collapse(!t),s.removeChild(e),a&&i[t?"moveStart":"moveEnd"]("character",o),i},((m=function(e){this.textRange=e,this.refresh()}).prototype=new s(document)).refresh=function(){n=this.textRange,t=n.parentElement(),(r=n.duplicate()).collapse(!0),o=r.parentElement(),(r=n.duplicate()).collapse(!1),n=r.parentElement();var e,t,n,o=(r=o==n?o:R.getCommonAncestor(o,n))==t?r:R.getCommonAncestor(t,r),r=0==(n=this.textRange).compareEndPoints("StartToEnd",n)?e=i(this.textRange,o,!0,!0).boundaryPosition:(e=(t=i(this.textRange,o,!0,!1)).boundaryPosition,i(this.textRange,o,!1,!1,t.nodeInfo).boundaryPosition);this.setStart(e.node,e.offset),this.setEnd(r.node,r.offset)},m.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(m),m.rangeToTextRange=r=function(e){var t,n;return e.collapsed?o(new v(e.startContainer,e.startOffset),!0):(t=o(new v(e.startContainer,e.startOffset),!0),n=o(new v(e.endContainer,e.endOffset),!1),(e=c(s.getRangeDocument(e)).createTextRange()).setEndPoint("StartToStart",t),e.setEndPoint("EndToEnd",n),e)},m.prototype.toTextRange=function(){return r(this)},n.WrappedTextRange=m,n.features.implementsDomRange&&!n.config.preferTextRange||(void 0===(p=Function("return this;")()).Range&&(p.Range=m),n.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),c(e).createTextRange()},n.WrappedRange=m)),n.createRange=function(e){return e=d(e,t,"createRange"),new n.WrappedRange(n.createNativeRange(e))},n.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},a.createAliasForDeprecatedMethod(n,"createIframeRange","createRange"),a.createAliasForDeprecatedMethod(n,"createIframeRangyRange","createRangyRange"),n.addShimListener(function(e){var t=e.document;void 0===t.createRange&&(t.createRange=function(){return n.createRange(t)}),t=null})}),N.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(i,s){i.config.checkSelectionRanges=!0;var r,o,k="boolean",e="number",a=i.dom,t=i.util,n=t.isHostMethod,c=i.DomRange,d=i.WrappedRange,f=i.DOMException,H=a.DomPosition,u=i.features,l="Control",h=a.getDocument,g=a.getBody,L=c.rangesEqual;function W(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function p(e,t){return e?a.isWindow(e)?e:e instanceof b?e.win:(e=a.getContentDocument(e,s,t),a.getWindow(e)):window}function F(e){return p(e,"getDocSelection").document.selection}function z(e){var t=!1;return t=e.anchorNode?1==a.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset):t}var m=n(window,"getSelection"),R=t.isHostObject(document,"selection"),v=(u.implementsWinGetSelection=m,(u.implementsDocSelection=R)&&(!m||i.config.preferTextRange));if(v)r=F,i.isSelectionValid=function(e){var e=p(e,"isSelectionValid").document,t=e.selection;return"None"!=t.type||h(t.createRange().parentElement())==e};else{if(!m)return s.fail("Neither document.selection or window.getSelection() detected."),!1;r=function(e){return p(e,"getWinSelection").getSelection()},i.isSelectionValid=function(){return!0}}m=(i.getNativeSelection=r)();if(!m)return s.fail("Native selection was null (possibly issue 138?)"),!1;var j=i.createNativeRange(document),V=g(document),C=t.areHostProperties(m,["anchorNode","focusNode","anchorOffset","focusOffset"]),N=(u.selectionHasAnchorAndFocus=C,n(m,"extend")),U=(u.selectionHasExtend=N,typeof m.rangeCount==e),q=(u.selectionHasRangeCount=U,!1),Y=!0,Q=N?function(e,t){var n=c.getRangeDocument(t),n=i.createRange(n);n.collapseToPoint(t.endContainer,t.endOffset),e.addRange($(n)),e.extend(t.startContainer,t.startOffset)}:null;if(t.areHostMethods(m,["addRange","getRangeAt","removeAllRanges"])&&typeof m.rangeCount==e&&u.implementsDomRange){var E=window.getSelection();if(E){for(var G=E.rangeCount,S=1<G,y=[],X=z(E),w=0;w<G;++w)y[w]=E.getRangeAt(w);var Z=a.createTestElement(document,"",!1),T=Z.appendChild(document.createTextNode("   ")),O=document.createRange();for(O.setStart(T,1),O.collapse(!0),E.removeAllRanges(),E.addRange(O),Y=1==E.rangeCount,E.removeAllRanges(),S||(S=window.navigator.appVersion.match(/Chrome\/(.*?) /),q=!(S&&36<=parseInt(S[1]))&&(S=O.cloneRange(),O.setStart(T,0),S.setEnd(T,3),S.setStart(T,2),E.addRange(O),E.addRange(S),2==E.rangeCount)),a.removeNode(Z),E.removeAllRanges(),w=0;w<G;++w)0==w&&X?Q?Q(E,y[w]):(i.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),E.addRange(y[w])):E.addRange(y[w])}}u.selectionSupportsMultipleRanges=q,u.collapsedNonEditableSelectionsSupported=Y;var _,D=!1;function A(e,t,n){var o=n?"end":"start",n=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[n+"Container"],e.focusOffset=t[n+"Offset"]}function x(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function $(e){var t;return e instanceof c?((t=i.createNativeRange(e.getDocument())).setEnd(e.endContainer,e.endOffset),t.setStart(e.startContainer,e.startOffset)):e instanceof d?t=e.nativeRange:u.implementsDomRange&&e instanceof a.getWindow(e.startContainer).Range&&(t=e),t}function J(e){var t=e.getNodes();if(function(e){if(e.length&&1==e[0].nodeType){for(var t=1,n=e.length;t<n;++t)if(!a.isAncestorOf(e[0],e[t]))return;return 1}}(t))return t[0];throw s.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element")}function K(e){return e&&void 0!==e.text}function ee(e,t){t=new d(t);e._ranges=[t],A(e,t,!1),e.rangeCount=1,e.isCollapsed=t.collapsed}function I(e){if(e._ranges.length=0,"None"==e.docSelection.type)x(e);else{var t=e.docSelection.createRange();if(K(t))ee(e,t);else{e.rangeCount=t.length;for(var n,o=h(t.item(0)),r=0;r<e.rangeCount;++r)(n=i.createRange(o)).selectNode(t.item(r)),e._ranges.push(n);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,A(e,e._ranges[e.rangeCount-1],!1)}}}function te(e,t){for(var n=e.docSelection.createRange(),t=J(t),o=h(n.item(0)),r=g(o).createControlRange(),i=0,a=n.length;i<a;++i)r.add(n.item(i));try{r.add(t)}catch(e){throw s.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),I(e)}function b(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function ne(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}V&&n(V,"createControlRange")&&(T=V.createControlRange(),t.areHostProperties(T,["item","add"])&&(D=!0)),u.implementsControlRange=D,o=C?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},n(m,"getRangeAt")?_=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:C&&(_=function(e){var t=h(e.anchorNode),t=i.createRange(t);return t.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),t.collapsed!==this.isCollapsed&&t.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),t}),b.prototype=i.selectionPrototype;var P=[];function oe(e,t){for(var n,o,r=P.length;r--;)if(o=(n=P[r]).selection,"deleteAll"==t)ne(o);else if(n.win==e)return"delete"==t?(P.splice(r,1),!0):o;return"deleteAll"==t&&(P.length=0),null}function re(e){if(e&&e instanceof b)return e.refresh(),e;var t=oe(e=p(e,"getNativeSelection")),n=r(e),o=R?F(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new b(n,o,e),P.push({win:e,selection:t})),t}i.getSelection=re,t.createAliasForDeprecatedMethod(i,"getIframeSelection","getSelection");var B,O=b.prototype;function ie(e,t){for(var n,o=h(t[0].startContainer),r=g(o).createControlRange(),i=0,a=t.length;i<a;++i){n=J(t[i]);try{r.add(n)}catch(e){throw s.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),I(e)}if(!v&&C&&t.areHostMethods(m,["removeAllRanges","addRange"])){O.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),x(this)};function ae(e,t){Q(e.nativeSelection,t),e.refresh()}O.addRange=U?function(e,t){if(D&&R&&this.docSelection.type==l)te(this,e);else if(W(t)&&N)ae(this,e);else{var t=q?this.rangeCount:(this.removeAllRanges(),0),n=$(e).cloneRange();try{this.nativeSelection.addRange(n)}catch(e){}this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==t+1?(i.config.checkSelectionRanges&&(n=_(this.nativeSelection,this.rangeCount-1))&&!L(n,e)&&(e=new d(n)),this._ranges[this.rangeCount-1]=e,A(this,e,M(this.nativeSelection)),this.isCollapsed=o(this)):this.refresh()}}:function(e,t){W(t)&&N?ae(this,e):(this.nativeSelection.addRange($(e)),this.refresh())},O.setRanges=function(e){if(D&&R&&1<e.length)ie(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(n(m,"empty")&&n(j,"select")&&D&&v))return s.fail("No means of selecting a Range or TextRange was found"),!1;O.removeAllRanges=function(){try{var e,t;this.docSelection.empty(),"None"!=this.docSelection.type&&(this.anchorNode?e=h(this.anchorNode):this.docSelection.type==l&&(t=this.docSelection.createRange()).length&&(e=h(t.item(0))),e&&(g(e).createTextRange().select(),this.docSelection.empty()))}catch(e){}x(this)},O.addRange=function(e){this.docSelection.type==l?te(this,e):(i.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,A(this,e,!1))},O.setRanges=function(e){this.removeAllRanges();var t=e.length;1<t?ie(this,e):t&&this.addRange(e[0])}}if(O.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new f("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},v)B=function(e){var t;i.isSelectionValid(e.win)?t=e.docSelection.createRange():(t=g(e.win.document).createTextRange()).collapse(!0),e.docSelection.type==l?I(e):K(t)?ee(e,t):x(e)};else if(n(m,"getRangeAt")&&typeof m.rangeCount==e)B=function(e){if(D&&R&&e.docSelection.type==l)I(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var t=0,n=e.rangeCount;t<n;++t)e._ranges[t]=new i.WrappedRange(e.nativeSelection.getRangeAt(t));A(e,e._ranges[e.rangeCount-1],M(e.nativeSelection)),e.isCollapsed=o(e)}else x(e)};else{if(!C||typeof m.isCollapsed!=k||typeof j.collapsed!=k||!u.implementsDomRange)return s.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;B=function(e){var t,n=e.nativeSelection;n.anchorNode?(n=_(n,0),e._ranges=[n],e.rangeCount=1,t=(n=e).nativeSelection,n.anchorNode=t.anchorNode,n.anchorOffset=t.anchorOffset,n.focusNode=t.focusNode,n.focusOffset=t.focusOffset,e.isCollapsed=o(e)):x(e)}}O.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(B(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;r--;)if(!L(t[r],this._ranges[r]))return!0;return!1}};function se(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,r=n.length;o<r;++o)L(t,n[o])||e.addRange(n[o]);e.rangeCount||x(e)}var M;function ce(e,t){if(e.win.document!=h(t))throw new f("WRONG_DOCUMENT_ERR")}function de(o){return function(e,t){var n;this.rangeCount?(n=this.getRangeAt(0))["set"+(o?"Start":"End")](e,t):(n=i.createRange(this.win.document)).setStartAndEnd(e,t),this.setSingleRange(n,this.isBackward())}}function fe(e){var t=[],n=new H(e.anchorNode,e.anchorOffset),o=new H(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=c.inspect(e.getRangeAt(i));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}O.removeRange=D&&R?function(e){if(this.docSelection.type==l){for(var t=this.docSelection.createRange(),n=J(e),o=h(t.item(0)),r=g(o).createControlRange(),i=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||i?r.add(t.item(a)):i=!0;r.select(),I(this)}else se(this,e)}:function(e){se(this,e)},!v&&C&&u.implementsDomRange?(M=z,O.isBackward=function(){return M(this)}):M=O.isBackward=function(){return!1},O.isBackwards=O.isBackward,O.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},O.collapse=function(e,t){ce(this,e);var n=i.createRange(e);n.collapseToPoint(e,t),this.setSingleRange(n),this.isCollapsed=!0},O.collapseToStart=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},O.collapseToEnd=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},O.selectAllChildren=function(e){ce(this,e);var t=i.createRange(e);t.selectNodeContents(e),this.setSingleRange(t)},O.deleteFromDocument=function(){if(D&&R&&this.docSelection.type==l){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),a.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,r=n.length;o<r;++o)n[o].deleteContents();this.addRange(n[r-1])}}},O.eachRange=function(e,t){for(var n=0,o=this._ranges.length;n<o;++n)if(e(this.getRangeAt(n)))return t},O.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},O.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},O.callMethodOnEachRange=function(t,n){var o=[];return this.eachRange(function(e){o.push(e[t].apply(e,n||[]))}),o},O.setStart=de(!0),O.setEnd=de(!1),i.rangePrototype.select=function(e){re(this.getDocument()).setSingleRange(this,e)},O.changeEachRange=function(t){var n=[],e=this.isBackward();this.eachRange(function(e){t(e),n.push(e)}),this.removeAllRanges(),e&&1==n.length?this.addRange(n[0],"backward"):this.setRanges(n)},O.containsNode=function(t,n){return this.eachRange(function(e){return e.containsNode(t,n)},!0)||!1},O.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},O.moveToBookmark=function(e){for(var t,n,o=[],r=0;t=e.rangeBookmarks[r++];)(n=i.createRange(this.win)).moveToBookmark(t),o.push(n);e.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},O.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},O.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},O.toHtml=function(){var t=[];return this.eachRange(function(e){t.push(c.toHtml(e))}),t.join("")},u.implementsTextRange&&(O.getNativeTextRange=function(){if(e=this.docSelection){var e=e.createRange();if(K(e))return e;throw s.createError("getNativeTextRange: selection is a control selection")}if(0<this.rangeCount)return i.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw s.createError("getNativeTextRange: selection contains no range")}),O.getName=function(){return"WrappedSelection"},O.inspect=function(){return fe(this)},O.detach=function(){oe(this.win,"delete"),ne(this)},b.detachAll=function(){oe(null,"deleteAll")},b.inspect=fe,b.isDirectionBackward=W,i.Selection=b,i.selectionPrototype=O,i.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return re(e)}),e=null})});function B(e){M||(M=!0,!N.initialized&&N.config.autoInitialize&&_())}var M=!1;return v&&("complete"==document.readyState?B():(f(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,!1),m(window,"load",B))),N},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(c,a){var r=c.dom,s=r.removeNode,d=c.Selection.isDirectionBackward,i="\ufeff";function f(e,t){return(t||document).getElementById(e)}function u(e,t){var n="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=r.getDocument(e.startContainer),e=e.cloneRange();return e.collapse(t),(t=o.createElement("span")).id=n,t.style.lineHeight="0",t.style.display="none",t.className="rangySelectionBoundary",t.appendChild(o.createTextNode(i)),e.insertNode(t),t}function l(e,t,n,o){n=f(n,e);n?(t[o?"setStartBefore":"setEndBefore"](n),s(n)):a.warn("Marker element has been removed. Cannot restore selection.")}function h(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function g(e,t){var n,o=c.DomRange.getRangeDocument(e),r=e.toString(),t=d(t);return e.collapsed?{document:o,markerId:(n=u(e,!1)).id,collapsed:!0}:(n=u(e,!1),{document:o,startMarkerId:u(e,!0).id,endMarkerId:n.id,collapsed:!1,backward:t,toString:function(){return"original text: '"+r+"', new text: '"+e.toString()+"'"}})}function o(e,t){var n,o,r=e.document,i=(void 0===t&&(t=!0),c.createRange(r));return e.collapsed?(n=f(e.markerId,r))?(n.style.display="inline",(o=n.previousSibling)&&3==o.nodeType?(s(n),i.collapseToPoint(o,o.length)):(i.collapseBefore(n),s(n))):a.warn("Marker element has been removed. Cannot restore selection."):(l(r,i,e.startMarkerId,!0),l(r,i,e.endMarkerId,!1)),t&&i.normalizeBoundaries(),i}function p(e,t){var n,o,r=[],i=d(t);(e=e.slice(0)).sort(h);for(var a=0,s=e.length;a<s;++a)r[a]=g(e[a],i);for(a=s-1;0<=a;--a)n=e[a],o=c.DomRange.getRangeDocument(n),n.collapsed?n.collapseAfter(f(r[a].markerId,o)):(n.setEndBefore(f(r[a].endMarkerId,o)),n.setStartAfter(f(r[a].startMarkerId,o)));return r}function m(e){for(var t=[],n=e.length-1;0<=n;n--)t[n]=o(e[n],!0);return t}function R(e,t){t=f(t,e);t&&s(t)}c.util.extend(c,{saveRange:g,restoreRange:o,saveRanges:p,restoreRanges:m,saveSelection:function(e){if(!c.isSelectionValid(e))return a.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var t=c.getSelection(e),n=t.getAllRanges(),o=1==n.length&&t.isBackward(),r=p(n,o);return o?t.setSingleRange(n[0],o):t.setRanges(n),{win:e,rangeInfos:r,restored:!1}},restoreSelection:function(e,t){var n,o,r;e.restored||(n=e.rangeInfos,o=c.getSelection(e.win),r=m(n),1==n.length&&t&&c.features.selectionHasExtend&&n[0].backward?(o.removeAllRanges(),o.addRange(r[0],!0)):o.setRanges(r),e.restored=!0)},removeMarkerElement:R,removeMarkers:function(e){for(var t,n=e.rangeInfos,o=0,r=n.length;o<r;++o)(t=n[o]).collapsed?R(e.doc,t.markerId):(R(e.doc,t.startMarkerId),R(e.doc,t.endMarkerId))}})}),e},this);